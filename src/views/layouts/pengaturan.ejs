<!--
=========================================================
Material Dashboard - v2.1.2
=========================================================

Product Page: https://www.creative-tim.com/product/material-dashboard
Copyright 2020 Creative Tim (https://www.creative-tim.com)
Coded by Creative Tim

=========================================================
The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software. -->
<!DOCTYPE html>
<html lang="en">
<link href="css/material-dashboard.css?v=2.1.2" rel="stylesheet" />

<body class="">
  <div class="wrapper ">
    <div class="sidebar" data-color="azure" data-background-color="white" data-image="/img/sidebar-1.jpg">
      <div class="logo"><a href="./dashboard" class="simple-text logo-normal">
          SIAP BERGOTA
        </a></div>
      <div class="sidebar-wrapper">
        <ul class="nav">
          <li class="nav-item">
            <a class="nav-link" href="./dashboard">
              <i class="material-icons">dashboard</i>
              <p>Data Makam</p>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="./tables">
              <i class="material-icons">content_paste</i>
              <p>Daftar Makam</p>
            </a>
          </li>
          <li class="nav-item active">
            <a class="nav-link" href="./pengaturan">
              <i class="material-icons">settings</i>
              <p>Pengaturan</p>
            </a>
          </li>
          <li class="nav-item center">
            <form method="post" action="/logout?_method=DELETE">
              <button type="submit" class="btn btn-danger">
                Keluar
              </button>
            </form>
          </li>
      </div>
    </div>
    <div class="main-panel">
      <!-- Navbar -->
      <nav class="navbar navbar-expand-lg navbar-transparent navbar-absolute fixed-top ">
        <div class="container-fluid">
          <div class="navbar-wrapper">
          </div>
          <button class="navbar-toggler" type="button" data-toggle="collapse" aria-controls="navigation-index"
            aria-expanded="false" aria-label="Toggle navigation">
            <span class="sr-only">Toggle navigation</span>
            <span class="navbar-toggler-icon icon-bar"></span>
            <span class="navbar-toggler-icon icon-bar"></span>
            <span class="navbar-toggler-icon icon-bar"></span>
          </button>
        </div>
      </nav>
      <!-- End Navbar -->
      <div class="content">
        <div class="container-fluid">
          <div class="row">
            <div class="col-md-12">
              <div class="card">
                <div class="card-header card-header-primary">
                  <h4 class="card-title ">Data Juru Kunci</h4>
                </div>
                <div class="card-body">
                  <div class="col-md-12">
                    <!-- Button to Open the Modal -->
                    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modalJuruKunci">
                      Tambah Data Juru Kunci
                    </button>
                    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modalDataDashboard">
                      Edit Data Dashboard
                    </button>
                  </div>

                  <div class="table-responsive">
                    <div id="tableIPAProv">
                      <table id="table" data-toggle="table" data-height="480" data-ajax="ajaxRequest"
                        data-side-pagination="server" data-pagination="true" data-detail-view="true"
                        data-show-columns="true" data-show-fullscreen="true" data-buttons-class="primary"
                        data-detail-formatter="detailFormatter">
                      </table>
                    </div>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>
      </div>

    </div>
  </div>
  <div id="modalJuruKunci" class="modal">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <div class="col-md-8">
            <h3 class="modal-title" id="exampleModalLongTitle">Tambah Juru Kunci</h3>
          </div>
          <div class="col-md-4">
            <button onclick="document.getElementById('modalJuruKunci').style.display='none'" type="button"
              class="btn btn-danger btn-block" data-dismiss="modal">Batal</button>
          </div>
        </div>
        <div class="modal-body">
          <div class="p-3">
            <form action="/addDataJuruKunci" method="POST">
              <div class="form-group">
                <label class="label-control">Nama Juru Kunci</label>
                <input type="text" maxlength="7" name="namaJuruMakam" placeholder="Masukkan Nama Juru Kunci Makam"
                  class="form-control" required autofocus required>
              </div>
              <div class="form-group">
                <label class="label-control">Blok Juru Kunci</label>
                <input type="text" name="blokJuruMakam" placeholder="Masukkan Blok Juru Kunci Makam"
                  class="form-control" required autofocus required>
              </div>
              <div class="form-group">
                <label class="label-control">No. Telepon Juru Kunci </label>
                <input type="text" maxlength="12" name="noTeleponJuruMakam"
                  placeholder="Masukkan No. Telepon Juru Kunci Makam" class="form-control" required autofocus>
              </div>
              <div class="form-group">
                <label class="label-control">Alamat Juru Kunci</label>
                <input type="text" name="alamatJuruMakam" placeholder="Masukkan Alamat Juru Kunci Makam"
                  class="form-control" required autofocus required>
              </div>
              <button class="btn btn-primary btn-block">
                Tambah Data
              </button>

            </form>
          </div>
        </div>

      </div>
    </div>
  </div>
  <div id="modalDataDashboard" class="modal">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <div class="col-md-8">
            <h3 class="modal-title" id="exampleModalLongTitle">Detail Data</h3>
          </div>
          <div class="col-md-4">
            <button onclick="document.getElementById('modalDataDashboard').style.display='none'" type="button"
              class="btn btn-danger btn-block" data-dismiss="modal">Batal</button>
          </div>
        </div>
        <div class="modal-body">
          <div class="p-3">
            <form action="/editDataBiaya" method="POST">
              <div class="form-group">
                <label class="label-control">Tarif Penyediaan Makam (Rp)</label>
                <input type="text" pattern="\d*" maxlength="7" name="hargaPenyediaanMakam"
                  placeholder="Masukkan Harga Penyediaan Makam" class="form-control" <% if (datamasukkan) { %>
                  value=<%= datamasukkan.hargaPenyediaanMakam %> <% } %> required autofocus>
              </div>
              <div class="form-group">
                <label class="label-control">BIAYA RETRIBUSI Makam Pertama (Rp)</label>
                <input type="text" pattern="\d*" maxlength="7" name="hargaSewaPertama"
                  placeholder="Masukkan BIAYA RETRIBUSI Makam Tiga Tahun Pertama (Per 3 Tahun)" class="form-control"
                  <% if (datamasukkan) { %> value=<%= datamasukkan.hargaSewaPertama %> <% } %> required autofocus>
              </div>
              <div class="form-group">
                <label class="label-control">BIAYA RETRIBUSI Makam Kedua (Rp)</label>
                <input type="text" maxlength="7" name="hargaSewaKedua"
                  placeholder="Masukkan BIAYA RETRIBUSI Makam Tiga Tahun Kedua (Per 3 Tahun)" class="form-control"
                  <% if (datamasukkan) { %> value=<%= datamasukkan.hargaSewaKedua %> <% } %> required autofocus>
              </div>
              <div class="form-group">
                <label class="label-control">BIAYA RETRIBUSI Makam Ketiga (Rp)</label>
                <input type="text" maxlength="7" name="hargaSewaKetiga"
                  placeholder="Masukkan BIAYA RETRIBUSI Makam Tiga Tahun Ketiga (Per 3 Tahun)" class="form-control"
                  <% if (datamasukkan) { %> value=<%= datamasukkan.hargaSewaKetiga %> <% } %> required autofocus>
              </div>
              <div class="form-group">
                <label class="label-control">BIAYA RETRIBUSI Makam Seterusnya (Rp)</label>
                <input type="text" maxlength="7" name="hargaSewaKeempat"
                  placeholder="Masukkan BIAYA RETRIBUSI Makam Tiga Tahun Keempat dan Seterusnya (Per 3 Tahun)"
                  class="form-control" <% if (datamasukkan) { %> value=<%= datamasukkan.hargaSewaKeempat %> <% } %>
                  required autofocus>
              </div>
              <div class="form-group">
                <label class="label-control">Harga Retribusi Pembongkaran Makam (Rp)</label>
                <input type="text" maxlength="7" name="hargaSewaPembongkaran"
                  placeholder="Masukkan Harga Retribusi Pembongkaran Makam" class="form-control"
                  <% if (datamasukkan) { %> value=<%= datamasukkan.hargaSewaPembongkaran %> <% } %> required autofocus>
              </div>
              <button class="btn btn-primary btn-block">
                Perbaharui Data
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>

  </div>
  <div class="modal fade" id="modalDataBerhasil" tabindex="-1" role="dialog" aria-labelledby="modalDataBerhasilTitle"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modalDataBerhasilTitle">Data Berhasil Dirubah</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div id="popup" class="modal-body">
          Data Berhasil dirubah.
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Ok</button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal" id="modalKonfirmasi" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Konfirmasi Hapus Data</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <p>Apakah anda akan menghapus data ini?</p>
        </div>
        <div class="modal-footer">
          <button type="button" id="btnHapus" class="btn btn-primary">Ya</button>
          <button type="button" class="btn btn-danger" data-dismiss="modal">Tidak</button>
        </div>
      </div>
    </div>
  </div>

</body>





<script src="https://unpkg.com/bootstrap-table@1.17.1/dist/bootstrap-table.min.js"></script>
<script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>




<script>
  var dataTerpilih;
  $("#btnHapus").click(function () {
    $.post('/hapusDataJuruMakam', // url
      dataTerpilih, // data to be submit
      function (data, status, jqXHR) { // success callback
        // alert('You click like action, row: ' + JSON.stringify(dataTerpilih))
        const popupnya = document.getElementById("popup");
        popupnya.innerText = info;
        popupnya.style.display = "block";
        $('#modalDataBerhasil').modal('show')
      });
  });
  $("input[required], select[required]").attr("oninvalid",
    "this.setCustomValidity('Masukkan ini tidak boleh kosong')");
  $("input[required], select[required]").attr("oninput", "setCustomValidity('')");

  function detailFormatter(index, row) {
    var html = []
    $.each(row, function (key, value) {
      html.push('<p><b>' + key + ':</b> ' + value + '</p>')
    })
    return html.join('')
  }

  function ajaxRequest(params) {
    var url = '/getDataJuri'
    $.get(url + '?' + $.param(params.data)).then(function (res) {
      params.success(res)
      console.log(res)
    })
  }

  var $table = $('#table')
  var $remove = $('#remove')
  var selections = []

  function getIdSelections() {
    return $.map($table.bootstrapTable('getSelections'), function (row) {
      return row.id
    })
  }

  function responseHandler(res) {
    $.each(res.rows, function (i, row) {
      row.state = $.inArray(row.id, selections) !== -1
    })
    return res
  }

  function detailFormatter(index, row) {
    var html = []
    $.each(row, function (key, value) {
      html.push('<p><b>' + key + ':</b> ' + value + '</p>')
    })
    return html.join('')
  }

  function operateFormatter(value, row, index) {
    return [
      '<a class="edit" href="javascript:void(0)" title="Edit Data">',
      '<button type="button" class="btn btn-primary">Edit Data</button>',
      '</a>',
      '<a class="remove" href="javascript:void(0)" title="Hapus Data">',
      '<button type="button" class="btn btn-danger">Hapus Data</button>',
      '</a>  ',
    ].join('')
  }

  window.operateEvents = {
    'click .remove': function (e, value, row, index) {
      $('#modalKonfirmasi').modal('show');
      dataTerpilih = row;
      // $.post('/hapusDataJuruMakam', // url
      //   row, // data to be submit
      //   function (data, status, jqXHR) { // success callback
      //     alert('You click like action, row: ' + JSON.stringify(row))
      //   });
    },
    'click .edit': function (e, value, row, index) {
      $('[name=namaJuruMakam]').val(row['Nama Juru Makam'])
      $('[name=blokJuruMakam]').val(row['Blok Juru Makam'])
      $('[name=alamatJuruMakam]').val(row['Alamat Juru Makam'])
      $('[name=noTeleponJuruMakam]').val(row['No. Telepon Juru Makam'])
      $('#modalJuruKunci').modal('show');
    }
  }

  function totalTextFormatter(data) {
    return 'Total'
  }

  function totalNameFormatter(data) {
    return data.length
  }

  function totalPriceFormatter(data) {
    var field = this.field
    return '$' + data.map(function (row) {
      return +row[field].substring(1)
    }).reduce(function (sum, i) {
      return sum + i
    }, 0)
  }

  function initTable() {
    $table.bootstrapTable('destroy').bootstrapTable({
      height: 550,
      locale: $('#locale').val(),
      columns: [
        [{
            field: 'Nama Juru Makam',
            title: 'Nama Juru Makam',
            sortable: true,
            footerFormatter: totalNameFormatter,
            align: 'center'
          },
          {
            field: 'Blok Juru Makam',
            title: 'Blok Juru Makam',
            sortable: true,
            footerFormatter: totalNameFormatter,
            align: 'center'
          },
          {
            field: 'Alamat Juru Makam',
            title: 'Alamat Juru Makam',
            sortable: true,
            footerFormatter: totalNameFormatter,
            align: 'center'
          },
          {
            field: 'No. Telepon Juru Makam',
            title: 'No. Telepon Juru Makam',
            sortable: true,
            align: 'center',
            footerFormatter: totalPriceFormatter
          },
          {
            field: 'Edit Data',
            title: 'Edit Data',
            align: 'center',
            clickToSelect: false,
            events: window.operateEvents,
            formatter: operateFormatter
          }
        ]
      ]
    })
    $table.on('check.bs.table uncheck.bs.table ' +
      'check-all.bs.table uncheck-all.bs.table',
      function () {
        $remove.prop('disabled', !$table.bootstrapTable('getSelections').length)

        // save your data, here just save the current page
        selections = getIdSelections()
        // push or splice the selections if you want to save all data selections
      })
    $table.on('all.bs.table', function (e, name, args) {
      console.log(name, args)
    })
    $remove.click(function () {
      var ids = getIdSelections()
      $table.bootstrapTable('remove', {
        field: 'id',
        values: ids
      })
      $remove.prop('disabled', true)
    })
  }

  $(function () {
    initTable()
    $('#locale').change(initTable)
  })

  const urlParams = new URLSearchParams(window.location.search);
  const info = urlParams.get('info');
  if (info) {
    console.log(info)
    // const errorMessage = document.getElementById("error-message");
    // errorMessage.innerText = info;
    // errorMessage.style.display = "block";

    const popupnya = document.getElementById("popup");
    popupnya.innerText = info;
    popupnya.style.display = "block";
    $('#modalDataBerhasil').modal('show')
    var newURL = location.href.split("?")[0];
    window.history.pushState('object', document.title, newURL);

  }
</script>